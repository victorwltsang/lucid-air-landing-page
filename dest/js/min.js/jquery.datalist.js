$.fn.datalist=function(){return"object"==typeof this[0].list&&document.createElement("datalist")&&window.HTMLDataListElement?this:this.each(function(){var $this=$(this),datalist=$("#"+$this.attr("list")),opts=datalist.find("option"),width=$this.width(),height=$this.height(),ul=$("<ul>",{class:"datalist",width:width,css:{position:"absolute",left:0,top:height+6,margin:0,padding:"0 2px","list-style":"none",border:"1px solid #ccc","-moz-box-shadow":"0px 2px 3px #ccc","-webkit-box-shadow":"0px 2px 3px #ccc","box-shadow":"0px 2px 3px #ccc","z-index":99,background:"#fff",cursor:"default"}}),wrapper=$("<div>").css("position","relative");if(!datalist.length)return this;opts.each(function(i,opt){$("<li>").append('<span class="value">'+opt.value+"</span>").append('<span class="label" style="float:right">'+opt.label+"</span>").appendTo(ul)}),$this.wrap(wrapper),ul.hide().insertAfter($this),$this.focus(function(){ul.show()}),$this.blur(function(){ul.hide()}),$this.next().find("li").mousedown(function(){var value=$(this).find("span.value").text();$this.val(value)})})};