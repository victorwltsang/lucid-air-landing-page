var EasyAutocomplete=function(scope){return scope.main=function($input,options){var requestDelayTimeoutId,consts=new scope.Constans,config=new scope.Configuration(options),logger=new scope.Logger,template=new scope.Template(options.template),listBuilderService=new scope.ListBuilderService(config,scope.proccess),checkParam=config.equals,$field=$input,$container="",elementsList=[],selectedElement=-1;function prepareField(){var $elements_container;function highlight(string,phrase){return config.get("highlightPhrase")&&""!==phrase?function(string,phrase){var escapedPhrase=(str=phrase,str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));var str;return(string+"").replace(new RegExp("("+escapedPhrase+")","gi"),"<b>$1</b>")}(string,phrase):string}$field.parent().hasClass(consts.getValue("WRAPPER_CSS_CLASS"))&&($field.next("."+consts.getValue("CONTAINER_CLASS")).remove(),$field.unwrap()),function(){var $wrapper=$("<div>"),classes=consts.getValue("WRAPPER_CSS_CLASS");config.get("theme")&&""!==config.get("theme")&&(classes+=" eac-"+config.get("theme"));config.get("cssClasses")&&""!==config.get("cssClasses")&&(classes+=" "+config.get("cssClasses"));""!==template.getTemplateClass()&&(classes+=" "+template.getTemplateClass());$wrapper.addClass(classes),$field.wrap($wrapper),!0===config.get("adjustWidth")&&(fieldWidth=$field.outerWidth(),$field.parent().css("width",fieldWidth));var fieldWidth}(),($elements_container=$("<div>").addClass(consts.getValue("CONTAINER_CLASS"))).attr("id",getContainerId()).prepend($("<ul>")),$elements_container.on("show.eac",function(){switch(config.get("list").showAnimation.type){case"slide":var animationTime=config.get("list").showAnimation.time,callback=config.get("list").showAnimation.callback;$elements_container.find("ul").slideDown(animationTime,callback);break;case"fade":var animationTime=config.get("list").showAnimation.time,callback=config.get("list").showAnimation.callback;$elements_container.find("ul").fadeIn(animationTime);break;default:$elements_container.find("ul").show()}config.get("list").onShowListEvent()}).on("hide.eac",function(){switch(config.get("list").hideAnimation.type){case"slide":var animationTime=config.get("list").hideAnimation.time,callback=config.get("list").hideAnimation.callback;$elements_container.find("ul").slideUp(animationTime,callback);break;case"fade":var animationTime=config.get("list").hideAnimation.time,callback=config.get("list").hideAnimation.callback;$elements_container.find("ul").fadeOut(animationTime,callback);break;default:$elements_container.find("ul").hide()}config.get("list").onHideListEvent()}).on("selectElement.eac",function(){$elements_container.find("ul li").removeClass("selected"),$elements_container.find("ul li").eq(selectedElement).addClass("selected"),config.get("list").onSelectItemEvent()}).on("loadElements.eac",function(event,listBuilders,phrase){var $item="",$listContainer=$elements_container.find("ul");$listContainer.empty().detach(),elementsList=[];for(var counter=0,builderIndex=0,listBuildersLength=listBuilders.length;builderIndex<listBuildersLength;builderIndex+=1){var listData=listBuilders[builderIndex].data;if(0!==listData.length){void 0!==listBuilders[builderIndex].header&&0<listBuilders[builderIndex].header.length&&$listContainer.append("<div class='eac-category' >"+listBuilders[builderIndex].header+"</div>");for(var i=0,listDataLength=listData.length;i<listDataLength&&counter<listBuilders[builderIndex].maxListSize;i+=1)$item=$("<li><div class='eac-item'></div></li>"),function(){var j=i,itemCounter=counter,elementsValue=listBuilders[builderIndex].getValue(listData[j]);$item.find(" > div").on("click",function(){$field.val(elementsValue).trigger("change"),selectElement(selectedElement=itemCounter),config.get("list").onClickEvent(),config.get("list").onChooseEvent()}).mouseover(function(){selectElement(selectedElement=itemCounter),config.get("list").onMouseOverEvent()}).mouseout(function(){config.get("list").onMouseOutEvent()}).html(template.build(highlight(elementsValue,phrase),listData[j]))}(),$listContainer.append($item),elementsList.push(listData[i]),counter+=1}}$elements_container.append($listContainer),config.get("list").onLoadEvent()}),$field.after($elements_container),$container=$("#"+getContainerId()),config.get("placeholder")&&$field.attr("placeholder",config.get("placeholder"))}function getContainerId(){var elementId=$field.attr("id");return elementId=consts.getValue("CONTAINER_ID")+elementId}function showContainer(){$container.trigger("show.eac")}function hideContainer(){$container.trigger("hide.eac")}function selectElement(index){$container.trigger("selectElement.eac",index)}function loadElements(list,phrase){$container.trigger("loadElements.eac",[list,phrase])}scope.consts=consts,this.getConstants=function(){return consts},this.getConfiguration=function(){return config},this.getContainer=function(){return $container},this.getSelectedItemIndex=function(){return selectedElement},this.getItems=function(){return elementsList},this.getItemData=function(index){return elementsList.length<index||void 0===elementsList[index]?-1:elementsList[index]},this.getSelectedItemData=function(){return this.getItemData(selectedElement)},this.build=function(){prepareField()},this.init=function(){!function(){if(0===$field.length)return logger.error("Input field doesn't exist.");if(!config.checkDataUrlProperties())return logger.error("One of options variables 'data' or 'url' must be defined.");if(!config.checkRequiredProperties())return logger.error("Will not work without mentioned properties.");prepareField(),function(){function bindKeyup(){$field.off("keyup").keyup(function(event){switch(event.keyCode){case 27:hideContainer(),$field.trigger("blur");break;case 38:event.preventDefault(),0<elementsList.length&&0<selectedElement&&(selectedElement-=1,$field.val(config.get("getValue")(elementsList[selectedElement])),selectElement(selectedElement));break;case 40:event.preventDefault(),0<elementsList.length&&selectedElement<elementsList.length-1&&(selectedElement+=1,$field.val(config.get("getValue")(elementsList[selectedElement])),selectElement(selectedElement));break;default:if(40<event.keyCode||8===event.keyCode){var inputPhrase=$field.val();!0!==config.get("list").hideOnEmptyPhrase||8!==event.keyCode||""!==inputPhrase?0<config.get("requestDelay")?(void 0!==requestDelayTimeoutId&&clearTimeout(requestDelayTimeoutId),requestDelayTimeoutId=setTimeout(function(){loadData(inputPhrase)},config.get("requestDelay"))):loadData(inputPhrase):hideContainer()}}function loadData(inputPhrase){if(!(inputPhrase.length<config.get("minCharNumber"))){if("list-required"!==config.get("data")){var data=config.get("data"),listBuilders=listBuilderService.init(data);listBuilders=listBuilderService.updateCategories(listBuilders,data),loadElements(listBuilders=listBuilderService.processData(listBuilders,inputPhrase),inputPhrase),0<$field.parent().find("li").length?showContainer():hideContainer()}var settings=createAjaxSettings();void 0!==settings.url&&""!==settings.url||(settings.url=config.get("url")),void 0!==settings.dataType&&""!==settings.dataType||(settings.dataType=config.get("dataType")),void 0!==settings.url&&"list-required"!==settings.url&&(settings.url=settings.url(inputPhrase),settings.data=config.get("preparePostData")(settings.data,inputPhrase),$.ajax(settings).done(function(data){var listBuilders=listBuilderService.init(data);listBuilders=listBuilderService.updateCategories(listBuilders,data),listBuilders=listBuilderService.convertXml(listBuilders),checkInputPhraseMatchResponse(inputPhrase,data)&&loadElements(listBuilders=listBuilderService.processData(listBuilders,inputPhrase),inputPhrase),listBuilderService.checkIfDataExists(listBuilders)&&0<$field.parent().find("li").length?showContainer():hideContainer(),config.get("ajaxCallback")()}).fail(function(){logger.warning("Fail to load response data")}).always(function(){}))}function createAjaxSettings(){var settings={},ajaxSettings=config.get("ajaxSettings")||{};for(var set in ajaxSettings)settings[set]=ajaxSettings[set];return settings}function checkInputPhraseMatchResponse(inputPhrase,data){return!1===config.get("matchResponseProperty")||("string"==typeof config.get("matchResponseProperty")?data[config.get("matchResponseProperty")]===inputPhrase:"function"!=typeof config.get("matchResponseProperty")||config.get("matchResponseProperty")(data)===inputPhrase)}}})}!function(){checkParam("autocompleteOff",!0)&&$field.attr("autocomplete","off");$field.focusout(function(){var phrase,fieldValue=$field.val();config.get("list").match.caseSensitive||(fieldValue=fieldValue.toLowerCase());for(var i=0,length=elementsList.length;i<length;i+=1)if(phrase=config.get("getValue")(elementsList[i]),config.get("list").match.caseSensitive||(phrase=phrase.toLowerCase()),phrase===fieldValue)return void selectElement(selectedElement=i)}),bindKeyup(),$field.on("keydown",function(evt){var keyCode=(evt=evt||window.event).keyCode;if(38===keyCode)return!(suppressKeypress=!0)}).keydown(function(event){13===event.keyCode&&-1<selectedElement&&($field.val(config.get("getValue")(elementsList[selectedElement])),config.get("list").onKeyEnterEvent(),config.get("list").onChooseEvent(),selectedElement=-1,hideContainer(),event.preventDefault())}),$field.off("keypress"),$field.focus(function(){""!==$field.val()&&0<elementsList.length&&(selectedElement=-1,showContainer())}),$field.blur(function(){setTimeout(function(){selectedElement=-1,hideContainer()},250)})}()}()}()}},scope.eacHandles=[],scope.getHandle=function(id){return scope.eacHandles[id]},scope.inputHasId=function(input){return void 0!==$(input).attr("id")&&0<$(input).attr("id").length},scope.assignRandomId=function(input){for(var fieldId="";fieldId="eac-"+Math.floor(1e4*Math.random()),0!==$("#"+fieldId).length;);elementId=scope.consts.getValue("CONTAINER_ID")+fieldId,$(input).attr("id",fieldId)},scope.setHandle=function(handle,id){scope.eacHandles[id]=handle},scope}((EasyAutocomplete=function(scope){return scope.Template=function(options){var genericTemplates={basic:{type:"basic",method:function(element){return element},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(element){return element+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(element){return element},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(element){return element},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(element){return element},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}};this.getTemplateClass=function(options){var _cssClass,emptyStringFunction=function(){return""};return options&&options.type&&options.type&&genericTemplates[options.type]?(_cssClass=genericTemplates[options.type].cssClass,function(){return _cssClass}):emptyStringFunction}(options),this.build=function(options){return options&&options.type&&options.type&&genericTemplates[options.type]?(_fields=(template=options).fields,"description"===template.type?(buildMethod=genericTemplates.description.method,"string"==typeof _fields.description?buildMethod=function(elementValue,element){return elementValue+" - <span>"+element[_fields.description]+"</span>"}:"function"==typeof _fields.description&&(buildMethod=function(elementValue,element){return elementValue+" - <span>"+_fields.description(element)+"</span>"}),buildMethod):"iconRight"===template.type?("string"==typeof _fields.iconSrc?buildMethod=function(elementValue,element){return elementValue+"<img class='eac-icon' src='"+element[_fields.iconSrc]+"' />"}:"function"==typeof _fields.iconSrc&&(buildMethod=function(elementValue,element){return elementValue+"<img class='eac-icon' src='"+_fields.iconSrc(element)+"' />"}),buildMethod):"iconLeft"===template.type?("string"==typeof _fields.iconSrc?buildMethod=function(elementValue,element){return"<img class='eac-icon' src='"+element[_fields.iconSrc]+"' />"+elementValue}:"function"==typeof _fields.iconSrc&&(buildMethod=function(elementValue,element){return"<img class='eac-icon' src='"+_fields.iconSrc(element)+"' />"+elementValue}),buildMethod):"links"===template.type?("string"==typeof _fields.link?buildMethod=function(elementValue,element){return"<a href='"+element[_fields.link]+"' >"+elementValue+"</a>"}:"function"==typeof _fields.link&&(buildMethod=function(elementValue,element){return"<a href='"+_fields.link(element)+"' >"+elementValue+"</a>"}),buildMethod):"custom"===template.type?template.method:genericTemplates.basic.method):genericTemplates.basic.method;var template,buildMethod,_fields}(options)},scope}((EasyAutocomplete=function(scope){return scope.proccess=function(config,listBuilder,phrase){scope.proccess.match=match;var list=listBuilder.data;return list=function(list){config.get("list").sort.enabled&&list.sort(config.get("list").sort.method);return list}(list=function(list){void 0!==listBuilder.maxNumberOfElements&&list.length>listBuilder.maxNumberOfElements&&(list=list.slice(0,listBuilder.maxNumberOfElements));return list}(list=function(list,phrase){var preparedList=[];if(config.get("list").match.enabled)for(var i=0,length=list.length;i<length;i+=1)match(config.get("getValue")(list[i]),phrase)&&preparedList.push(list[i]);else preparedList=list;return preparedList}(list,phrase)));function match(value,phrase){return config.get("list").match.caseSensitive||("string"==typeof value&&(value=value.toLowerCase()),phrase=phrase.toLowerCase()),!!config.get("list").match.method(value,phrase)}},scope}((EasyAutocomplete=function(scope){return scope.ListBuilderService=function(configuration,proccessResponseData){function convertToListBuilder(category,data){var builder={};if(builder="XML"===configuration.get("dataType").toUpperCase()?function(){var listLocation,builder={};void 0!==category.xmlElementName&&(builder.xmlElementName=category.xmlElementName);void 0!==category.listLocation?listLocation=category.listLocation:void 0!==configuration.get("listLocation")&&(listLocation=configuration.get("listLocation"));void 0!==listLocation?"string"==typeof listLocation?builder.data=$(data).find(listLocation):"function"==typeof listLocation&&(builder.data=listLocation(data)):builder.data=data;return builder}():function(){var builder={};void 0!==category.listLocation?"string"==typeof category.listLocation?builder.data=data[category.listLocation]:"function"==typeof category.listLocation&&(builder.data=category.listLocation(data)):builder.data=data;return builder}(),void 0!==category.header&&(builder.header=category.header),void 0!==category.maxNumberOfElements&&(builder.maxNumberOfElements=category.maxNumberOfElements),void 0!==configuration.get("list").maxNumberOfElements&&(builder.maxListSize=configuration.get("list").maxNumberOfElements),void 0!==category.getValue)if("string"==typeof category.getValue){var defaultsGetValue=category.getValue;builder.getValue=function(element){return element[defaultsGetValue]}}else"function"==typeof category.getValue&&(builder.getValue=category.getValue);else builder.getValue=configuration.get("getValue");return builder}function convertXmlToList(builder){var simpleList=[];return void 0===builder.xmlElementName&&(builder.xmlElementName=configuration.get("xmlElementName")),$(builder.data).find(builder.xmlElementName).each(function(){simpleList.push(this)}),simpleList}this.init=function(data){var listBuilder=[],builder={};return builder.data=configuration.get("listLocation")(data),builder.getValue=configuration.get("getValue"),builder.maxListSize=configuration.get("list").maxNumberOfElements,listBuilder.push(builder),listBuilder},this.updateCategories=function(listBuilder,data){if(configuration.get("categoriesAssigned")){listBuilder=[];for(var i=0;i<configuration.get("categories").length;i+=1){var builder=convertToListBuilder(configuration.get("categories")[i],data);listBuilder.push(builder)}}return listBuilder},this.convertXml=function(listBuilder){if("XML"===configuration.get("dataType").toUpperCase())for(var i=0;i<listBuilder.length;i+=1)listBuilder[i].data=convertXmlToList(listBuilder[i]);return listBuilder},this.processData=function(listBuilder,inputPhrase){for(var i=0,length=listBuilder.length;i<length;i+=1)listBuilder[i].data=proccessResponseData(configuration,listBuilder[i],inputPhrase);return listBuilder},this.checkIfDataExists=function(listBuilders){for(var i=0,length=listBuilders.length;i<length;i+=1)if(void 0!==listBuilders[i].data&&listBuilders[i].data instanceof Array&&0<listBuilders[i].data.length)return!0;return!1}},scope}((EasyAutocomplete=function(scope){return scope.Constans=function(){var constants={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(propertyName){return constants[propertyName]}},scope}((EasyAutocomplete=function(scope){return scope.Logger=function(){this.error=function(message){console.log("ERROR: "+message)},this.warning=function(message){console.log("WARNING: "+message)}},scope}((EasyAutocomplete=function(scope){return scope.Configuration=function(options){var defaults={data:"list-required",url:"list-required",dataType:"json",listLocation:function(data){return data},xmlElementName:"",getValue:function(element){return element},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(a,b){return(a=defaults.getValue(a))<(b=defaults.getValue(b))?-1:b<a?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(element,phrase){return-1<element.search(phrase)}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(data,inputPhrase){return data},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},externalObjects=["ajaxSettings","template"];function printPropertiesThatDoesntExist(consol,optionsToCheck){!function checkPropertiesIfExist(source,target){for(var property in target)void 0===source[property]&&consol.log("Property '"+property+"' does not exist in EasyAutocomplete options API."),"object"==typeof source[property]&&-1===$.inArray(property,externalObjects)&&checkPropertiesIfExist(source[property],target[property])}(defaults,optionsToCheck)}this.get=function(propertyName){return defaults[propertyName]},this.equals=function(name,value){return!(!function(name){return void 0!==defaults[name]&&null!==defaults[name]}(name)||defaults[name]!==value)},this.checkDataUrlProperties=function(){return"list-required"!==defaults.url||"list-required"!==defaults.data},this.checkRequiredProperties=function(){for(var propertyName in defaults)if("required"===defaults[propertyName])return logger.error("Option "+propertyName+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(consol,optionsToCheck){printPropertiesThatDoesntExist(consol,optionsToCheck)},function(){"xml"===options.dataType&&(options.getValue||(options.getValue=function(element){return $(element).text()}),options.list||(options.list={}),options.list.sort||(options.list.sort={}),options.list.sort.method=function(a,b){return a=options.getValue(a),b=options.getValue(b),a<b?-1:b<a?1:0},options.list.match||(options.list.match={}),options.list.match.method=function(element,phrase){return-1<element.search(phrase)});if(void 0!==options.categories&&options.categories instanceof Array){for(var categories=[],i=0,length=options.categories.length;i<length;i+=1){var category=options.categories[i];for(var property in defaults.categories[0])void 0===category[property]&&(category[property]=defaults.categories[0][property]);categories.push(category)}options.categories=categories}}(),!0===(defaults=function mergeObjects(source,target){var mergedObject=source||{};for(var propertyName in source)void 0!==target[propertyName]&&null!==target[propertyName]&&("object"!=typeof target[propertyName]||target[propertyName]instanceof Array?mergedObject[propertyName]=target[propertyName]:mergeObjects(source[propertyName],target[propertyName]));return void 0!==target.data&&null!==target.data&&"object"==typeof target.data&&(mergedObject.data=target.data),mergedObject}(defaults,options)).loggerEnabled&&printPropertiesThatDoesntExist(console,options),void 0!==options.ajaxSettings&&"object"==typeof options.ajaxSettings?defaults.ajaxSettings=options.ajaxSettings:defaults.ajaxSettings={},function(){if("list-required"!==defaults.url&&"function"!=typeof defaults.url){var defaultUrl=defaults.url;defaults.url=function(){return defaultUrl}}if(void 0!==defaults.ajaxSettings.url&&"function"!=typeof defaults.ajaxSettings.url){var defaultUrl=defaults.ajaxSettings.url;defaults.ajaxSettings.url=function(){return defaultUrl}}if("string"==typeof defaults.listLocation){var defaultlistLocation=defaults.listLocation;"XML"===defaults.dataType.toUpperCase()?defaults.listLocation=function(data){return $(data).find(defaultlistLocation)}:defaults.listLocation=function(data){return data[defaultlistLocation]}}if("string"==typeof defaults.getValue){var defaultsGetValue=defaults.getValue;defaults.getValue=function(element){return element[defaultsGetValue]}}void 0!==options.categories&&(defaults.categoriesAssigned=!0)}()},scope}(EasyAutocomplete||{}))||{}))||{}))||{}))||{}))||{}))||{});!function($){$.fn.easyAutocomplete=function(options){return this.each(function(){var $this=$(this),eacHandle=new EasyAutocomplete.main($this,options);EasyAutocomplete.inputHasId($this)||EasyAutocomplete.assignRandomId($this),eacHandle.init(),EasyAutocomplete.setHandle(eacHandle,$this.attr("id"))})},$.fn.getSelectedItemIndex=function(){var inputId=$(this).attr("id");return void 0!==inputId?EasyAutocomplete.getHandle(inputId).getSelectedItemIndex():-1},$.fn.getItems=function(){var inputId=$(this).attr("id");return void 0!==inputId?EasyAutocomplete.getHandle(inputId).getItems():-1},$.fn.getItemData=function(index){var inputId=$(this).attr("id");return void 0!==inputId&&-1<index?EasyAutocomplete.getHandle(inputId).getItemData(index):-1},$.fn.getSelectedItemData=function(){var inputId=$(this).attr("id");return void 0!==inputId?EasyAutocomplete.getHandle(inputId).getSelectedItemData():-1}}(jQuery);